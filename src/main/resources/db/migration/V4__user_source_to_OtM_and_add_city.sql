DROP TABLE USERS_SOURCES;

ALTER TABLE IF EXISTS SOURCES ADD COLUMN USER_ID INT;
ALTER TABLE IF EXISTS SOURCES ADD CONSTRAINT SOURCES_USER_ID_FKEY FOREIGN KEY (USER_ID) REFERENCES USERS;

CREATE TABLE CITIES (
    CITY_ID INT4 GENERATED BY DEFAULT AS IDENTITY,
    NAME VARCHAR(255), REGION_ID INT,
    PRIMARY KEY (CITY_ID));

ALTER TABLE IF EXISTS CITIES ADD CONSTRAINT CITIES_REGION_ID_FKEY FOREIGN KEY (REGION_ID) REFERENCES REGIONS;

ALTER TABLE IF EXISTS INSTITUTIONS DROP CONSTRAINT INSTITUTIONS_REGION_ID_FKEY;
ALTER TABLE IF EXISTS INSTITUTIONS DROP COLUMN REGION_ID;
ALTER TABLE IF EXISTS INSTITUTIONS ADD COLUMN CITY_ID INT;
ALTER TABLE IF EXISTS INSTITUTIONS ADD CONSTRAINT INSTITUTIONS_CITY_ID_FKEY FOREIGN KEY (CITY_ID) REFERENCES CITIES;
